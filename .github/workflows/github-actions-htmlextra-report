name: Run Postman Tests with Newman and Generate HTML Report

on:
  push:
    branches:
      - main  # Triggers when code is pushed to the main branch

jobs:
  run-tests:
    runs-on: ubuntu-latest  # Runs the job on an Ubuntu runner
    
    steps:
      - name: Checkout the repository
        uses: actions/checkout@v2  # Checks out the code from the repository

      - name: Set up Node.js
        uses: actions/setup-node@v2
        with:
          node-version: '14'  # You can specify the version of Node.js (change if needed)

      - name: Install Newman
        run: |
          npm install -g newman  # Install Newman globally

      - name: Run Postman Collection with Newman
        run: |
          newman run "Restful Booker BVT.postman_collection.json" -e "Production.postman_environment.json" --reporters cli,html --reporter-html-export newman-report.html
        # Make sure the paths to these files are correct, especially if they are inside specific directories

      - name: Upload HTML Report as Artifact
        uses: actions/upload-artifact@v2
        with:
          name: newman-html-report
          path: newman-report.html  # Path to the HTML report generated by Newman
